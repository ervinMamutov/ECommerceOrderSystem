# ==============================================
# TEST ENVIRONMENT CONFIGURATION
# ==============================================
# This file is activated when SPRING_PROFILES_ACTIVE=test
# Automatically used by @SpringBootTest

# -------------------- Database Configuration --------------------
# Use separate test database to avoid polluting dev data
spring.datasource.url=jdbc:postgresql://localhost:5432/ecommerce_test_db
spring.datasource.username=${DB_USERNAME:test_user}
spring.datasource.password=${DB_PASSWORD:test_pass}

# Recreate schema for each test run for clean state
spring.jpa.hibernate.ddl-auto=create-drop

# Show SQL for debugging failing tests
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# -------------------- Alternative: H2 In-Memory Database --------------------
# Uncomment to use H2 instead of PostgreSQL for faster tests
# spring.datasource.driver-class-name=org.h2.Driver
# spring.datasource.url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE
# spring.datasource.username=sa
# spring.datasource.password=
# spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect
# spring.h2.console.enabled=false

# -------------------- Logging Configuration --------------------
# Keep logs minimal during tests to reduce noise
logging.level.com.example.e_commerce=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN

# Uncomment for debugging specific test failures
# logging.level.com.example.e_commerce=DEBUG
# logging.level.org.hibernate.SQL=DEBUG

# -------------------- Test-Specific Settings --------------------
# Disable Flyway migrations in tests (use schema auto-creation)
spring.flyway.enabled=false

# Disable DevTools in tests
spring.devtools.restart.enabled=false

# Fast JSON serialization for tests
spring.jackson.serialization.indent-output=false

# -------------------- Actuator Configuration --------------------
# Disable actuator endpoints in tests (not needed)
management.endpoints.enabled-by-default=false

# -------------------- Performance Optimizations --------------------
# Disable caching during tests
spring.cache.type=none

# Disable template caching
spring.thymeleaf.cache=false

# -------------------- Security Configuration --------------------
# Simplified security for tests
server.error.include-message=always
server.error.include-stacktrace=always

# -------------------- Mock Services Configuration --------------------
# Use stub implementations for external services
PAYMENT_API_KEY=test_key
PAYMENT_API_SECRET=test_secret
PAYMENT_GATEWAY_URL=http://localhost:9999/mock-payment

# Disable email sending in tests
FEATURE_EMAIL_NOTIFICATIONS=false
spring.mail.host=localhost
spring.mail.port=3025

# -------------------- Test Database Setup --------------------
# Automatically create test database on first run
spring.sql.init.mode=always
# spring.sql.init.schema-locations=classpath:schema-test.sql
# spring.sql.init.data-locations=classpath:test-data.sql
